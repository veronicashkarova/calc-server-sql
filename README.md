



## РАСПРЕДЕЛЕННЫЙ ВЫЧИСЛИТЕЛЬ АРИФМЕТИЧЕСКИХ ВЫРАЖЕНИЙ С АВТОРИЗАЦИЕЙ ПОЛЬЗОВАТЕЛЕЙ

Данный сервер решает арифметические действия с числами, также учитывая скобки и другие арифметические знаки.

Сервер проверяет выражение на такие ошибки: некорректное выражение, пустое выражение.

Для использования сервера требуется регистрация пользователя (логин, пароль)

Для общения с сервером (отправка выражений для вычисления, получения списка выражений, получения результатов) требуется авторизация пользователя для получения авторизационного токена  

Он состоит из двух частей (модулей клиент-сервер):
- $${\color{red}Сервер \space (оркестратор)}$$  - принимает арифметическое выражение, переводит его в набор последовательных задач и обеспечивает порядок их выполнения(оркестратор). Сервер хранит выражения в БД.

  Расположен в директории orkestrator 
  
- $${\color{red}Клиент \space (агент)}$$ - получает от оркестратора задачу, выполнить его и вернуть серверу результат. Агент общается с сервером по GRPC протоколу.
  
  Расположен в директории agent

#
Для запуска оркестратора выполнить команду в директории orkestrator проекта:
```
go run ./cmd/main.go
```
при старте оркестратора в терминале выdодится строка "Server started"

#
Для запуска агента выполнить команду в директории agent проекта (в отдельном терминале):
```
go run ./cmd/main.go
```

## $\color{red}ОРКЕСТРАТОР$

Перед использованием сервера необходимо зарегистрировать нового пользователя (логин и пароль).

Пример:

$${\color{green}YourLogin}$$ - ваш логин

$${\color{green}YourPassword}$$ - ваш пароль



```
curl --location --request GET 'localhost/api/v1/register' \
--header 'Content-Type: application/json' \
--data '{
    "login": "YourLogin",
    "password": "YourPassword"
}'
```
Коды ответа: 200 - пользователь успешно зарегистрирован, 400 - что-то пошло не так

Новый пользователь регистрируется один раз, данные о пользователе сохраняются в БД

#
Для получения авторизационного токена необходимо авторизоваться с данными зарегистрируемого пользователя:
```
curl --location --request GET 'localhost/api/v1/login' \
--header 'Content-Type: application/json' \
--data '{
    "login": "YourLogin",
    "password": "YourPassword"
}'
```
Коды ответа: 200 - успешно, 400 - что-то пошло не так

При успешной авторизации в ответе приходит авторизационный токен. $${\color{green}Токен \space валиден \space 24 \space часа}$$

```
{
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NDY4NTk2MDMsImlhdCI6MTc0Njc3MzIwMywibmFtZSI6Ikl2YW4iLCJuYmYiOjE3NDY3NzMyMDN9.yT0h0BD978P5K9s-0ajuSlhHTU1dm3E02awzm76oP9o"
} 
```


Все дальнейшие запросы на сервер необходимо отправлять с использованием авторизационного токена. При отсуствии токена или невалидном токене сервер отвечает ошибкой      $${\color{red}"FAILED \space AUTORIZATION"}$$ (код 400)



#
Для добавления вычисления арифметического выражения:

$${\color{green}YourToken}$$ - ваш токен

```
curl --location --request GET 'localhost/api/v1/calculate' \
--header 'Authorization:  YourToken' \
--header 'Content-Type: application/json' \
--data '{
    "expression": "2+2"
}'
```
Коды ответа: 201 - выражение принято для вычисления, 422 - невалидные данные, 500 - что-то пошло не так

Пример ответа
```
{"id":"1"}
```
#
Для получения списка выражений:

$${\color{green}YourToken}$$ - ваш токен

```
curl --location 'localhost/api/v1/expressions' \
--header 'Authorization:  YourToken' 
```
Коды ответа: 200 - успешно получен список выражений, 400 - что-то пошло не так

Сервер возвращает список выражений только для конкретного пользователя

Пример ответа
```
{
    "expressions": [
        {
            "id": "1",
            "status": "Выполнено",
            "result": "4.000"
        },
        {
            "id": "2",
            "status": "в процессе выполнения",
            "result": "Неизвестно"
        },
        {
            "id": "3",
            "status": "в процессе выполнения",
            "result": "Неизвестно"
        }
    ]
}
```
#
Для получения выражения по его идентификатору;

$${\color{green}YourToken}$$ - ваш токен

$${\color{green}TaskId}$$ - Id задачи

```
curl --location 'localhost/api/v1/expressions/TaskId' \
--header 'Authorization:  YourToken' 
```

Коды ответа: 200 - успешно получено выражение, 404 - нет такого выражения, 500 - что-то пошло не так

Пример ответа:
```
{
    "id": "8",
    "status": "DONE",
    "result": "19.000"
}
```

## $\color{red}АГЕНТ$

Агент общается с сервером по GRPC протоколу. Для этого на оркестратор запускает GRPC-сервер
При запуске агент запускает несколько горутин, запрашивает у сервера новые задачи и вычисляет задачи с заданной в таске задержкой. При отсуствии задач в оркестраторе агент увеличивает задержку между запросами до 5 сек.
#
Для получения задачи агент отправляет серверу пустой запрос. В ответ получает задачи задачу в proto-формате:
```
message Task {
    int32 id = 1;
    float arg1 = 2;
    float arg2 = 3;
    string operation = 4;
    int32 operation_time = 5;
}
```

#
После выполнения вычислений агент возращает серверу результат вычислений:
```
message TaskResult {
    int32 id = 1;
    float result = 2;
}
```
При остуствии задач на сервере сервер отвечает ошибкой "НЕТ ДОСТУПНЫХ ЗАДАЧ" 

Результаты запросов и вычислений логируются агентом


## $\color{red}Ошибки$
При невалидном выражении, например
```
curl --location --request GET 'localhost/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
    "expression": "5-+"
}'
```
в статусе задачи будет выведена ошибка
```
{
    "expressions": [
        {
            "id": "1",
            "status": "неправильное выражение",
            "result": "Неизвестно"
        }
    ]
}
```
Примеры выводимых ошибок:
- ошибка авторизации
- неправильное выражение
- деление на ноль
- неправильный символ
- не хватает скобки
- пустое выражение
- не найдено выражение
- нет доступных задач

